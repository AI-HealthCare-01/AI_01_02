# AI Health Project 요구사항 정의서

문서 버전: v1.28  
작성일: 2026-02-27  
프로젝트 기간: 2026-02-20 ~ 2026-03-20  
배포 마감: 2026-03-13 (종료 1주 전)  
문서 목적: 프로젝트 범위, 구현 대상, 검수 기준을 명확히 합의한다.

문서 변경 이력:
- v1.28 (2026-02-27): 비기능 요구사항 ID 재번호화(기존 비기능 63~90번 -> `REQ-101~REQ-128`)를 반영해 본문 표/요약/체크리스트 참조를 동기화하고, 재검증 기준으로 구현 예시/권장 소스 과다 서술을 정리
- v1.27 (2026-02-27): 데이터 구축 섹션의 OCR 원본 폐기 기준 REQ 참조를 정정
- v1.26 (2026-02-27): 최신 `요구사항_정의서.xlsx` 반영으로 요구사항 90건(기능 62, 비기능 28)을 재동기화하고 기능/집계/체크리스트 참조를 갱신
- v1.25 (2026-02-27): 건강 프로필 입력 축을 `basic_info/lifestyle_input/sleep_input/nutrition_input` 4개 구조로 정리하고 관련 서술을 동기화
- v1.24 (2026-02-27): 보호자(선택) Actor 서술을 제거하고 보호자 전용 기능을 범위 제외(Out of Scope)로 명시
- v1.23 (2026-02-27): 회원 탈퇴 요구사항(`REQ-023`)을 소프트 삭제 기준(`is_active=false`)으로 구체화하고 토큰 즉시 무효화/접근 차단 정책을 명시
- v1.22 (2026-02-27): 최신 `요구사항_정의서.xlsx` 기준으로 요구사항 86건(기능 58, 비기능 28)을 전면 재동기화하고 챗봇 세션 삭제/회원 탈퇴 포함 최신 ID 체계를 반영
- v1.21 (2026-02-27): 중간 동기화 단계에서 요구사항 변동분을 반영해 문서/집계 구조를 재정렬
- v1.18 (2026-02-27): `요구사항 ID Naming` 시트 내용을 본문에 반영하고 `API_명세서.xlsx` 기준 정합성 검증 구조를 보강
- v1.17 (2026-02-27): 원본 산출물 파일명 변경(`docs/요구사항_정의서.xlsx`)에 맞춰 참조 경로를 최신화

## 1. 범위

- 필수 기능:
  - OCR 기반 의료정보 인식
  - LLM 기반 복약/생활습관 맞춤 가이드 생성
  - 실시간 챗봇 (RAG + Streaming + Safety Guardrail)
  - 사용자 건강 입력(신체기초/생활/수면/영양) 구조화 및 위험도 분석
  - 예외 상황 대응 UX(재촬영/수정/재시도) 및 에러 코드 기반 메시지 표준화
- 선택 기능:
  - 알림 기능(가이드 완료 알림, 복약 리마인더, 약 소진 D-day 알림)

## 2. 행위 주체(Actor)

- 일반 사용자: 회원가입, 로그인, 회원 탈퇴, 건강 프로필 입력, 문서 업로드, OCR 결과 확인/수정, 가이드 조회, 챗봇 사용, 챗봇 대화 세션 삭제
- AI 워커: OCR 처리, 파싱/정제, 가이드 생성, 챗봇 추론 파이프라인 처리
- 시스템(API 서버): 인증, 검증, DB 저장, 큐 발행, 스트리밍 응답, 예외 처리
- 운영자(팀): 배포, 모니터링, 장애 대응, 지식베이스/모델/약물사전 버전 관리

## 3. 타겟 사용자 및 서비스 목표

- 주 타겟:
  - ADHD 약물을 복용 중인 성인/소아 환자
- 사용자 시나리오:
  - 사용자 가입 -> 개인 건강/생활 정보 입력 -> 처방전/약봉투 업로드 -> OCR/정제/확인 -> 맞춤형 복약/생활 가이드 제공 -> 약 소진 D-day 알림 수신
- 서비스 목표:
  - ADHD 환자의 일상 기록을 데이터 기반 건강 지표로 분석해 꾸준한 복약, 부작용 관리, 생활 패턴 교정을 지원한다.

## 4. 시스템 상세 로직 (System Logic)

### A. 실시간 챗봇 (RAG + Streaming Architecture)

1. 챗봇 진입 시 사용자에게 객관식 대화 프롬프트를 제공해 질문 주제를 빠르게 선택할 수 있게 한다.
2. 사용자 질문 수신 후 의도 분류(잡담/의학 질의/위급 질의)를 수행한다.
3. 자살/자해/범죄/약물 오남용 위기 신호가 감지되면 LLM 호출을 차단하고 긴급 상담 안내를 즉시 반환한다.
4. 의학 질의는 의미 기반(Dense)과 키워드 기반(Lexical)을 결합한 하이브리드 검색으로 ADHD 전문 의학 지식/약물 정보 Top 3~5 문서를 회수한다.
5. 검색 유사도가 임계값 미만이면 무리한 답변 대신 "질문을 조금 더 구체적으로 해주세요" 형태로 재질문을 유도한다.
6. 질문(Query), 검색 문서(Context), 최근 대화 이력(History), 시스템 제약을 결합해 답변을 생성한다.
7. 근거 문서가 존재하는 경우 답변 하단에는 사용된 문서의 출처/제목/링크를 함께 제공한다.
8. 답변은 SSE(Server-Sent Events)로 스트리밍 전송한다.
9. 세션 입력이 10~30분 이상 없으면 자동 종료해 리소스를 회수한다.

### B. OCR 기반 의료정보 인식 (Capture -> OCR -> Parse -> Store)

1. 사용자는 카메라 촬영 또는 갤러리 선택으로 처방전/약봉투(PDF/JPG/PNG)를 업로드한다.
2. 서버는 외부 OCR 엔진으로 텍스트와 좌표를 추출한다.
3. 서버는 OCR 텍스트에서 `약품명/용량/1일 복용횟수/1회 복용개수/조제일/총 처방일`을 파싱한다.
4. 파싱 결과를 ADHD 약물 사전과 매핑 검증하고 신뢰도를 평가한다.
5. 임계값 미만이면 사용자 수정 요청(재촬영 또는 직접 수정) 단계로 전환한다.
6. 사용자 수정 단계에서 약품명은 처방 약물 DB 기반 자동완성(검색 추천)으로 선택 입력하게 해 오타를 줄인다.
7. 원본 업로드 이미지는 OCR/파싱 처리 완료 직후 즉시 폐기하며 DB/클라우드 스토리지에 파일 형태로 저장하지 않는다.
8. 확정 데이터는 DB 저장 후 복약 요약 문구와 알림 제안을 출력한다.

### C. 개인화 분석 및 가이드 생성

1. 사용자 입력(신체정보/생활습관/수면/영양)과 OCR 정제 데이터를 하나의 컨텍스트 객체로 병합한다.
2. RAG 지식(약물 상호작용, 식단/운동 가이드)과 결합해 개인별 복약/생활습관 가이드를 생성한다.
3. 출력은 `복약 안내`, `생활습관 코칭`, `주의사항/위험징후` 구조로 제공한다.
4. 최근 1주 일정/입력 데이터를 반영해 가이드를 주기적으로 갱신한다.
5. 약 소진일을 계산하여 소진 7일 전부터 D-day 알림을 발행한다.

### D. 예외/오류 응답 및 UX 표준화

1. 서버/워커 예외(네트워크 오류, 타임아웃, 검증 실패)는 내부 오류 코드를 표준화해 반환한다.
2. 프론트엔드는 오류 코드별 사용자 안내 메시지 매핑 테이블을 관리해 일관된 문구를 노출한다.
3. 오류 상황에서는 사용자가 즉시 다음 행동(재촬영/수정/재시도)을 선택할 수 있는 UI를 제공한다.
4. HTTP 5xx 에러율 급증, OCR/LLM 타임아웃 연속 발생 등 장애 징후를 실시간 감지하고 임계치 초과 시 담당자에게 즉시 경고 알림을 전송한다.
5. 배포로 인한 크리티컬 장애 발생 시 30분 이내 롤백 또는 임시 복구(Fallback) 절차를 수행할 수 있어야 한다.

## 5. 기능적 요구사항

| ID | 구분 | 카테고리 | 요구사항 명칭 | 상세 내용 | 우선순위 | 비고 | 상태 |
|---|---|---|---|---|---|---|---|
| REQ-001 | 기능 | 가이드 | 가이드 작업 생성 | OCR 파싱 결과를 최종 확인하는 즉시 사용자 정보와 확인된 처방 데이터를 기반으로 가이드 생성 작업을 비동기 큐에 등록하고 상태값을 반환해야 한다. | 높음 | job_id, QUEUED 반환 | 대기중 |
| REQ-002 | 기능 | 가이드 | 가이드 상태 조회 | 일반 사용자는 가이드 작업 상태(QUEUED/PROCESSING/SUCCEEDED/FAILED)를 확인할 수 있어야 한다. | 높음 | 본인 작업만 조회 가능 | 대기중 |
| REQ-003 | 기능 | 가이드 | 가이드 결과 조회 | 일반 사용자는 생성된 가이드(복약/생활습관/위험도)를 조회할 수 있어야 한다. | 높음 | 결과 JSON 반환 | 대기중 |
| REQ-004 | 기능 | 가이드 | 가이드 상세 명세 | 가이드는 복약 안내 (약물명, 복용시간, 주의사항), 생활습관(수면,운동,디지털사용,카페인,음주,흡연)에 대한 내용을 포함해야된다. | 높음 |  | 대기중 |
| REQ-005 | 기능 | 가이드 | 가이드 출처 고지 | 생성된 맞춤형 가이드 제공 시 결과의 객관성과 신뢰도 확보를 위해 가이드 도출 근거가 된 의학적 출처 및 데이터 원천 정보를 사용자에게 병행 명시해야 한다. | 중간 |  | 대기중 |
| REQ-006 | 기능 | 가이드 | 안전 고지 포함 | 시스템은 가이드 결과에 "의료진 진료 대체 불가" 고지 문구를 항상 포함해야 한다. | 높음 | 고정 문구 | 대기중 |
| REQ-007 | 기능 | 가이드 | 가이드 업데이트 | 가이드는 매주 1회(7일 주기)마다 사용자의 프로필, 최근 일주일간 축적된 일정 이행률 및 처방 데이터를 통합 분석하여 맞춤형 가이드의 최신성을 유지하고 정기적으로 업데이트해야 한다. | 중간 |  | 대기중 |
| REQ-008 | 기능 | 가이드 | 일정 이행률 명시 | 가이드 갱신 시점마다 분석 대상 기간 내의 전체 계획 일정 대비 실제 수행된 일정의 비중을 백분율(%) 단위의 이행률로 산출하여 결과 화면에 명시해야 한다. | 중간 |  | 대기중 |
| REQ-009 | 기능 | 가이드 | 출력 포맷 표준화 | 시스템은 사용자의 온보딩 과정을 통해 순차적으로 수집된 [프로필 입력 데이터]와 [OCR 처방 정보]를 결합하고, 이에 맞는 [RAG 지식]을 병합하여 최종 맞춤형 가이드 생성용 컨텍스트를 구성해야 한다. | 높음 | UI 일관성 | 대기중 |
| REQ-010 | 기능 | 가이드 | 일일 일정 상태 관리 | 사용자 맞춤형 일일 일정(복약·식사·수면)을 시계열 타임라인으로 제공하며, 개별 항목의 완료 버튼을 통해 실시간 이행 상태를 기록 및 관리한다. | 높음 |  | 대기중 |
| REQ-011 | 기능 | 권한 | 리소스 접근 권한 | 시스템은 사용자 본인 데이터(문서/작업/가이드/채팅/알림)만 접근 허용해야 한다. | 높음 | 타 사용자 접근 403/404 | 대기중 |
| REQ-012 | 기능 | 기능 | 예외 처리 | 서버/네트워크 오류, 타임아웃, 필수 정보 누락 등 예외 상황 발생 시, 사용자가 다음 행동(재촬영, 수정, 재시도)을 취할 수 있도록 명확한 에러 메시지와 UI(버튼 등)를 제공해야 한다. | 높음 | UX 라이팅 적용 | 대기중 |
| REQ-013 | 기능 | 분석 | 생활패턴 지표 분석 | 운동/디지털 사용/카페인/흡연/음주/수면/영양 입력을 건강 지표로 분석해야 한다. | 높음 | 위험도 계산 | 대기중 |
| REQ-014 | 기능 | 알림 | 위험 징후 플래그 | 알코올 위험, 과도한 졸림, 영양위험 등 위험 플래그를 자동 산출하고 이를 사용자에게 경고를 띄울수 있어야 한다. | 높음 | 경고문구 포함 | 대기중 |
| REQ-015 | 기능 | 알림 | 약물 알러지 경고 | 사용자의 약물 알러지 정보와 처방 약물을 대조해 충돌 시 사용자에게 경고를 제공해야 한다. | 높음 | 즉시 진료 안내 | 대기중 |
| REQ-016 | 기능 | 알림 | 알림 목록 조회 | 일반 사용자는 본인 알림 목록을 조회할 수 있어야 한다. | 중간 | 선택 기능 | 대기중 |
| REQ-017 | 기능 | 알림 | 미읽음 개수 조회 | 일반 사용자는 미읽음 알림 개수를 조회할 수 있어야 한다. | 중간 | 선택 기능 | 대기중 |
| REQ-018 | 기능 | 알림 | 알림 읽음 처리 | 일반 사용자는 단건 알림을 읽음 처리할 수 있어야 한다. | 중간 | 선택 기능 | 대기중 |
| REQ-019 | 기능 | 알림 | 전체 읽음 처리 | 일반 사용자는 본인 알림을 전체 읽음 처리할 수 있어야 한다. | 중간 | 선택 기능 | 대기중 |
| REQ-020 | 기능 | 알림 | 복약 리마인더 관리 | 일반 사용자는 복약 리마인더를 생성/조회/수정/삭제할 수 있어야 한다. | 낮음 | 선택 기능 확장 | 대기중 |
| REQ-021 | 기능 | 알림 | 약 소진 D-day 알림 | 약봉투의 조제일/총 처방일/복용량 기반으로 '조제일자'에 '총 처방일수'를 더하여 예상 소진일 계산 후 소진 7일 전부터 D-day 알림을 제공해야 한다. | 높음 | 7일 전 시작 | 대기중 |
| REQ-022 | 기능 | 예외처리 | OCR 실패 처리 | AI 워커 OCR 실패 시 상태를 FAILED로 변경하고, 사용자 화면에 시스템 오류 또는 화질 불량 등의 실패 사유 메시지를 노출해야 한다. (원본 즉시 폐기) | 높음 | 재시도 정책 별도 | 대기중 |
| REQ-023 | 기능 | 예외처리 | 가이드 생성 실패 처리 | LLM 호출 실패/시간초과 시 상태를 FAILED로 저장하고 실패 사유를 반환해야 한다. | 높음 | 타임아웃 기준 적용 | 대기중 |
| REQ-024 | 기능 | 인증 | 회원가입 | 일반 사용자는 이메일, 비밀번호, 이름, 성별, 생년월일, 전화번호로 회원가입할 수 있어야 한다. | 높음 | 이메일/전화번호 중복 불가 | 개발완료 |
| REQ-025 | 기능 | 인증 | 로그인 | 일반 사용자는 이메일+비밀번호로 로그인할 수 있어야 하며, 성공 시 액세스 토큰을 받아야 한다. | 높음 | refresh token은 HttpOnly 쿠키로 발급 | 진행중 |
| REQ-026 | 기능 | 인증 | 로그인 유지 | 일반 사용자는 refresh token으로 액세스 토큰을 재발급 받을 수 있어야 한다. | 높음 | refresh token 누락 시 401 | 대기중 |
| REQ-027 | 기능 | 인증 | 회원 탈퇴 | 일반 사용자는 본인 계정을 탈퇴할 수 있어야 하며, 탈퇴 완료 시 사용자 데이터는 하드 삭제하지 않고 소프트 삭제(`is_active=false`)로 비활성화해야 한다. 또한 access/refresh token을 즉시 무효화하고 본인 리소스 접근을 차단해야 한다. | 높음 | 소프트 삭제(is_active=false), 토큰 즉시 무효화 | 대기중 |
| REQ-028 | 기능 | 인증 | 보호 API 접근 제어 | 시스템은 API 호출 시 JWT 검증 후 사용자 식별에 성공한 요청만 처리해야 한다. | 높음 | 실패 시 401 | 대기중 |
| REQ-029 | 기능 | 챗봇 | 채팅 세션 생성 | 일반 사용자는 챗봇 세션을 생성하고 ACTIVE 상태로 사용할 수 있어야 한다. | 높음 | 세션 단위 이력 관리 | 대기중 |
| REQ-030 | 기능 | 챗봇 | 객관식 대화 프롬프트 | 일반 사용자는 챗봇 대화 시 객관식 대화 프롬프트를 사용하여 대화 주제를 정할 수 있어야 한다. | 높음 |  | 대기중 |
| REQ-031 | 기능 | 챗봇 | 메시지 송수신/저장 | 일반 사용자는 질문을 전송하고 답변을 수신해야 하며, 시스템은 USER/ASSISTANT 메시지를 모두 저장해야 한다. | 높음 | role, timestamp 저장 | 대기중 |
| REQ-032 | 기능 | 챗봇 | 대화 맥락 유지 | 시스템은 최근 5~10턴 이력과 사용자 정보 및 약 정보를 반영해서 대명사 표현(예: "그 약")을 해석해 응답해야 한다. | 높음 | 턴 수 설정 가능 | 대기중 |
| REQ-033 | 기능 | 챗봇 | 대화 이력 조회 | 일반 사용자는 세션별 대화 이력을 페이지네이션으로 조회할 수 있어야 한다. | 중간 | limit/offset 지원 | 대기중 |
| REQ-034 | 기능 | 챗봇 | 입력 의도 분류 | 시스템은 사용자 입력을 잡담/의학/위급으로 분류해야 한다. | 높음 | 분류 실패 시 안전 우선 | 대기중 |
| REQ-035 | 기능 | 챗봇 | 안전 가드레일 | 위급에 해당하는 자살/자해/범죄/약물 오남용 신호 감지 시 LLM 호출을 차단하고 긴급 상담 메시지를 반환해야 한다. | 높음 | 정책 문구 사전 정의 | 대기중 |
| REQ-036 | 기능 | 챗봇 | 벡터 검색 기반 지식 회수 | 의학 질의는 ADHD 전문 의학 지식 Vector DB에서 유사 문서 3~5개를 검색해 사용해야 한다. | 높음 | 검색 근거 로깅 | 대기중 |
| REQ-037 | 기능 | 챗봇 | 근거 제한 답변 | 챗봇은 승인된 의료 근거 기반 정보만으로 답변하고 근거 없으면 모른다고 응답해야 한다. | 높음 | Hallucination 억제 | 대기중 |
| REQ-038 | 기능 | 챗봇 | SSE 스트리밍 응답 | 챗봇 답변은 SSE로 스트리밍 전송되어야 한다. | 높음 | 첫 토큰 3초 이내 목표 | 대기중 |
| REQ-039 | 기능 | 챗봇 | 추론 감사 로그 | 시스템은 답변 생성 시 검색 문서 ID, 프롬프트 버전, 모델 버전을 추적 저장해야 한다. | 중간 | 운영/품질 분석 용도 | 대기중 |
| REQ-040 | 기능 | 챗봇 | 하이브리드 검색 | 시스템은 의학 질의 검색 시 Dense 벡터 검색과 키워드 검색(BM25 등)을 결합해 근거 문서를 회수해야 한다. | 높음 | 의미+단어 일치 보정 | 대기중 |
| REQ-041 | 기능 | 챗봇 | 출처 표기 응답 | 챗봇 답변은 근거 문서가 존재하는 경우 해당 문서의 제목/출처/링크를 하단에 표시해야 한다. | 중간 | 신뢰도 향상 | 대기중 |
| REQ-042 | 기능 | 챗봇 | 저유사도 재질문 유도 | 검색 유사도가 임계값 미만이면 확정 답변 대신 사용자에게 질문 구체화를 요청해야 한다. | 높음 | 무리한 생성 방지 | 대기중 |
| REQ-043 | 기능 | 챗봇 | 대화 세션 삭제 | 일반 사용자는 본인 챗봇 세션 전체를 삭제할 수 있어야 하며, 세션 삭제 시 해당 세션의 메시지/참조 데이터는 사용자 조회 경로에서 더 이상 노출되지 않아야 한다. | 높음 | 사용자 편의 | 대기중 |
| REQ-044 | 기능 | 챗봇 | 자동 세션 종료 | 입력/출력이 없는 비활성 세션은 10~30분 설정값 경과 시 CLOSED 상태로 자동 종료해야 한다. | 중간 | 리소스 회수 | 대기중 |
| REQ-045 | 기능 | 프로필 | 사용자 건강 프로필 입력 | 사용자는 기본정보(키/몸무게/알러지),생활습관(운동량/pc와 스마트폰사용 시간/커피복용량/흡연정도/음주 정도), 수면패턴(기상 및 수면 시간, 잠들기까지 걸리는 시간,밤에 깨는 횟수, 낮에 졸린 정도), 영양상태(식욕점수, 규칙적인 식사여부)를 입력할수있어야하며, BMI와 수면시간은 서버에서 자동 계산된다 | 높음 |  | 대기중 |
| REQ-046 | 기능 | 프로필 | 건강 프로필 확인 및 화면전환 | 프로필 입력 정보에 대한 사용자 최종 검토 및 데이터 확정 단계를 거쳐 저장을 수행하며, 저장(완료) 즉시 맞춤형 가이드 생성을 위한 차기 단계인 '처방전 스캔 안내' 페이지로의 자동 화면 전환 기능을 제공해야 한다. | 높음 | 설문 UI, Seamless 온보딩 플로우 (프로필 ➡️ 처방전 스캔) | 대기중 |
| REQ-047 | 기능 | 프로필 | 입력 데이터 구조화 | 시스템은 사용자 입력을 사전 정의한 입력 스키마 객체로 구조화해 저장해야 한다. | 높음 | JSON 스키마 검증 | 대기중 |
| REQ-048 | 기능 | LLM | 구조화 출력 강제 | LLM 응답은 정의된 JSON 스키마를 따르도록 강제하고 파싱 가능해야 한다. | 높음 | JSON 모드/스키마 강제 | 대기중 |
| REQ-049 | 기능 | LLM | 역할/제약 프롬프트 | 시스템 프롬프트에 역할/안전제약/의료진 상담 고지 규칙을 포함해야 한다. | 높음 | 정책 버전 관리 | 대기중 |
| REQ-050 | 기능 | OCR | 의료문서 업로드 | 일반 사용자는 스마트폰 카메라/갤러리를 통해 처방전/약봉투 파일(PDF/JPG/PNG)을 업로드할 수 있어야 한다. | 높음 | 모바일 우선 시나리오 | 대기중 |
| REQ-051 | 기능 | OCR | 업로드 유효성 검증 | 시스템은 허용 확장자 외 파일, 파일 크기 초과 파일, 손상 파일을 거절하고 사용자에게 "지원하지 않는 파일/용량 초과" 안내 메시지를 노출해야 한다. | 높음 | 거절 시 400/413 | 대기중 |
| REQ-052 | 기능 | OCR | 데이터 파싱 결과 스키마 저장 | OCR 엔진을 통해 처방전/약봉투 파일에서 약품명, 용량, 복용 횟수, 복용 방법, 처방 일수, 조제일의 비정형 텍스트를 추출 해 JSON 형태로 구조화한다 | 높음 | 정규식/LLM 보조 가능 | 대기중 |
| REQ-053 | 기능 | OCR | OCR 작업 생성 | 일반 사용자는 업로드 문서 OCR 작업을 생성할 수 있어야 하며, 시스템은 즉시 job_id와 QUEUED 상태를 반환해야 한다. | 높음 | 비동기 처리 | 대기중 |
| REQ-054 | 기능 | OCR | OCR 상태 확인 | 일반 사용자는 OCR 작업 상태(QUEUED/PROCESSING/SUCCEEDED/FAILED)를 확인할 수 있어야 한다. | 높음 | 본인 작업만 확인 가능 | 대기중 |
| REQ-055 | 기능 | OCR | OCR 결과 저장 및 원본 폐기 | AI 워커는 OCR 성공 시 raw 텍스트와 구조화 데이터(JSON)만 DB에 저장하며, 원본 업로드 이미지는 즉시 폐기한다. 단, 사용자 화면의 검수 UI(에러 항목 하이라이트 등)를 위해, 프론트엔드 API 응답에는 텍스트 블록의 좌표 데이터를 포함하여 반환해야 한다. | 높음 | 실패 시 error_message 저장 | 대기중 |
| REQ-056 | 기능 | OCR | OCR 엔진 연동 | 서버는 업로드 문서를 외부 OCR 엔진에 전달하고 추출된 텍스트와 사용자 검수 UI(하이라이트 박스) 렌더링을 위한 텍스트 좌표 데이터를 수신해야 한다. | 높음 | 엔진 교체 가능 구조 | 대기중 |
| REQ-057 | 기능 | OCR | 약물 매핑 검증 | 파싱된 약품명이 약물 리스트 DB와 일치하는지 검증하고 결과를 저장해야 한다. | 높음 | 미매핑 항목 검수 상태 | 대기중 |
| REQ-058 | 기능 | OCR | 인식 불량 시 재촬영 유도 처리 | 전체 인식 신뢰도가 낮거나 필수 정보가 누락된 경우, 원본을 즉시 폐기하고 사용자에게 "흔들림/반사/텍스트 부족" 등의 사유와 함께 재촬영 안내 메시지를 노출해야 한다. | 높음 | 전체 퀄리티 미달 케이스 | 대기중 |
| REQ-059 | 기능 | OCR | 촬영 가이드 UX 지원 | 프론트는 가이드 박스 오버레이, 좋은/나쁜 예 안내, 촬영 전 팝업을 제공해야 한다. | 중간 | 모바일 카메라 UX | 대기중 |
| REQ-060 | 기능 | OCR | 사용자 결과 출력 | 화면에 복약 시작 요약 문구와 알림 설정 제안을 출력해야 한다. | 중간 | 리마인더 연계 | 대기중 |
| REQ-061 | 기능 | OCR | 저신뢰 필드 수정 플로우 | 전체 인식은 성공했으나 개별 필드 신뢰도가 임계값(예: 0.85 미만)인 항목이 있을 경우, 해당 필드만 하이라이트(좌표 활용)하여 사용자가 직접 수정할 수 있는 화면으로 전환해야 한다 | 높음 | 부분 미달 케이스<br>중요도: 약물명 > 용량 > 횟수 > 일자 | 대기중 |
| REQ-062 | 기능 | OCR | 사용자 확인/수정 단계 | OCR 정제 결과를 사용자에게 보여주고 확인 또는 직접 수정 후 확정할 수 있어야 한다. 단, 약품명 수정 시 오타 방지 및 정확한 매핑을 위해 처방 약물 DB 기반의 '실시간 자동완성(검색 추천) 기능'을 제공하여 목록에서 선택하도록 해야 한다. | 높음 | Human-in-the-loop | 대기중 |

## 6. 비기능적 요구사항

| ID | 구분 | 카테고리 | 요구사항 명칭 | 상세 내용 | 우선순위 | 비고 | 상태 |
|---|---|---|---|---|---|---|---|
| REQ-101 | 비기능 | 가용성 | 장애 복구 및 롤백 | 배포로 인한 크리티컬 에러(앱 다운, 파싱/생성 기능 전면 마비) 발생 시, 30분 이내에 이전 안정 버전으로 코드를 롤백하거나, 외부 API 장애 시 임시 복구(Fallback) 절차를 수행할 수 있는 파이프라인과 매뉴얼이 있어야 한다. | 높음 | 운영 체크리스트 필요 | 대기중 |
| REQ-102 | 비기능 | 데이터 | 저장 포맷 표준화 | 문서, OCR 결과, 가이드, 채팅 데이터는 UTF-8과 JSON 스키마를 일관 사용해야 한다. | 중간 | 한글 깨짐 방지 | 대기중 |
| REQ-103 | 비기능 | 데이터 | 합성 데이터 우선 활용 | 모델 학습/테스트는 실제 환자 데이터 대신 합성 데이터 우선 정책을 따른다. | 높음 | 개인정보 이슈 완화 | 대기중 |
| REQ-104 | 비기능 | 데이터 | 스키마 유효성 강제 | 입력/출력 JSON은 스키마 검증 실패 시 저장/전송을 차단해야 한다. | 높음 | 데이터 무결성 | 대기중 |
| REQ-105 | 비기능 | 모니터링 | 추적 가능한 로그 | API/워커 로그에 request_id/job_id/user_id를 남겨 장애 추적이 가능해야 한다. | 높음 | 개인정보 마스킹 | 대기중 |
| REQ-106 | 비기능 | 배포 | 배포 완료 시점 | 프로젝트 종료 1주 전(2026-03-13)까지 스테이징/운영 배포가 완료되어야 한다. | 높음 | 평가 일정 준수 | 대기중 |
| REQ-107 | 비기능 | 보안 | 인증/암호화 | 비밀번호는 단방향 해시로 저장하고 인증은 JWT 기반으로 처리해야 한다. | 높음 | 평문 저장 금지 | 대기중 |
| REQ-108 | 비기능 | 보안 | 쿠키 보안 옵션 | 운영환경 refresh token 쿠키는 HttpOnly+Secure 옵션을 사용해야 한다. | 높음 | SameSite 정책 명시 | 대기중 |
| REQ-109 | 비기능 | 보안 | 전송 구간 암호화 | 운영환경 사용자 트래픽은 HTTPS(TLS)로 암호화되어야 한다. | 높음 | 인증서 갱신 자동화 | 대기중 |
| REQ-110 | 비기능 | 사용성 | 모바일 촬영 최적화 | OCR 입력 UI는 모바일 반응형과 카메라 촬영 UX를 우선 설계해야 한다. | 높음 | 스마트폰 주 시나리오 | 대기중 |
| REQ-111 | 비기능 | 사용성 | 에러 코드 및 메시지 매핑 | 프론트엔드는 백엔드가 반환하는 에러 코드를 바탕으로, 사용자에게 노출할 '사전 정의된 안내 메시지' 매핑 테이블을 관리해야 한다. | 중간 | 개발/사용자용 메시지 분리 | 대기중 |
| REQ-112 | 비기능 | 설명가능성 | 근거 추적성 | 가이드/경고 생성 시 사용된 입력 필드와 근거 출처를 추적 가능해야 한다. | 중간 | 감사/검증 용도 | 대기중 |
| REQ-113 | 비기능 | 성능 | 핵심 응답 지연 | 전체 API의 성능은 P95 Latency가 3초 이내로 수렴해야 한다. | 높음 | 평가 기준 반영 | 대기중 |
| REQ-114 | 비기능 | 성능 | 비동기 요청 즉시 응답 | OCR/가이드 작업 생성 API는 1초 이내 `202 Accepted`를 반환해야 한다. | 높음 | 무거운 처리 금지 | 대기중 |
| REQ-115 | 비기능 | 성능 | 비동기 논블로킹 처리 | 챗봇 스트리밍 API는 이벤트 루프 블로킹을 최소화해야 한다. | 높음 | 워커 오프로딩 병행 | 대기중 |
| REQ-116 | 비기능 | 성능 | OCR 처리 지연 기준 | 이미지 업로드 후 OCR 추출/파싱/결과 출력까지 권장 5초 이내를 목표로 한다. | 높음 | 로딩 스피너 필수 | 대기중 |
| REQ-117 | 비기능 | 안전성 | 가드레일 정책 감사성 | 위급 질의 차단 이벤트는 감사 가능한 형태로 기록/모니터링되어야 한다. | 높음 | 정책 위반 탐지 | 대기중 |
| REQ-118 | 비기능 | 안정성 | 비동기 상태 일관성 | Job 상태 전이는 `QUEUED -> PROCESSING -> SUCCEEDED/FAILED`만 허용한다. | 높음 | 불가능 전이 차단 | 대기중 |
| REQ-119 | 비기능 | 안정성 | 장애 감지 및 알림 | 시스템은 HTTP 5xx 에러율 급증, 주요 API(OCR, LLM) 타임아웃 연속 발생 등의 장애 징후를 실시간으로 모니터링하고, 임계치 초과 시 담당자에게 즉시 경고 알림을 발송해야 한다. | 높음 | Sentry/CloudWatch 등 연동 | 대기중 |
| REQ-120 | 비기능 | 안정성 | 외부 API 장애 대응 | OCR/LLM 외부 API 타임아웃, 재시도 로직을 구현하고, 프론트엔드에서 일관된 메시지를 띄울 수 있도록 내부 오류 코드를 표준화하여 반환해야 한다. | 높음 | 운영 알림 연계 | 대기중 |
| REQ-121 | 비기능 | 정확성 | 약 소진 계산 정확성 | 소진일 계산 로직은 조제일/복용주기/복용개수 반영 오차 없이 동작해야 한다. | 높음 | D-day 신뢰도 | 대기중 |
| REQ-122 | 비기능 | 테스트 | 자동 검증 | CI에서 테스트/린트/타입체크가 모두 통과해야 배포 가능하다. | 높음 | pytest/ruff/mypy | 대기중 |
| REQ-123 | 비기능 | 품질 | 프롬프트/모델 버전 고정 | 챗봇/가이드 품질 편차를 줄이기 위해 prompt/model/파라미터 버전을 관리해야 한다. | 높음 | 재현성 확보 | 대기중 |
| REQ-124 | 비기능 | 품질 | 필드별 신뢰도 정책 | OCR 필드별 최소 신뢰도와 재질문/수정 정책을 운영 설정으로 관리해야 한다. | 높음 | 필드 중요도 반영 | 대기중 |
| REQ-125 | 비기능 | 프라이버시 | 학습 데이터 재사용 금지 | 사용자 채팅 로그와 업로드 이미지는 모델 학습 데이터로 재사용하지 않아야 한다. | 높음 | 동의 기반 정책 별도 | 대기중 |
| REQ-126 | 비기능 | 프라이버시 | OCR 원본 이미지 즉시 폐기 | OCR/파싱 완료 직후 또는 큐 등록 실패 등 비동기 처리 실패 시, 원본 업로드 이미지는 즉시 영구 삭제하며 어떠한 경우에도 DB/클라우드 스토리지에 파일 형태로 보관하지 않아야 한다. | 높음 | 보안 정책 최우선, 데이터 최소화/비용 절감 | 대기중 |
| REQ-127 | 비기능 | 확장성 | 구조 확장성 | OCR/가이드/챗봇 모델 교체 시 API 계약 변경 없이 워커 레이어에서 교체 가능해야 한다. | 중간 | 추후 고도화 대비 | 대기중 |
| REQ-128 | 비기능 | 확장성 | 벡터 DB 무중단 갱신 | 의학 지식 문서 추가/수정 시 서비스 중단 없이 인덱스를 갱신할 수 있어야 한다. | 중간 | Blue/Green 권장 | 대기중 |

## 7. 데이터 구축 및 스키마

### 7.1 데이터 관리 원칙

- 본 문서에서는 요구사항 관점의 최소 데이터 원칙만 관리한다.
- 객체별 상세 필드/타입/nullable은 `docs/API_SPECIFICATION.md`의 객체 모델(11장)을 단일 기준으로 사용한다.
- 요구사항 변경 시, 우선 `요구사항_정의서.xlsx`와 본 문서를 맞춘 뒤 `API_SPECIFICATION.md` 상세 스키마를 연동 갱신한다.

### 7.2 도메인별 핵심 데이터 요구사항

- 챗봇 지식베이스:
  - 구축 원칙: 수집 -> 정제 -> 청크 -> 임베딩 -> 인덱싱, 출처/버전/갱신일 메타데이터 유지
- OCR/처방 데이터:
  - 기본 저장: `raw_text`, 구조화 처방 정보, 엔진 메타데이터
  - 선택 저장: 좌표(`raw_blocks`)는 저신뢰/검수 필요 케이스 우선
  - 원본 폐기: OCR/파싱 완료 직후 또는 비동기 실패 시 즉시 폐기 (`REQ-126`)
- 사용자 입력/분석 데이터:
  - 입력 축: `basic_info`, `lifestyle_input`, `sleep_input`, `nutrition_input`
  - 출력 축: `analysis_summary`, `personalized_guides`, `risk_flags`

### 7.3 운영 메타데이터

- 챗봇 프롬프트 메타: 객관식 프롬프트 선택 결과를 세션 컨텍스트로 저장
- 에러 매핑 메타: `error_code`, `user_message`, `developer_message`, `action_hint`, `retryable`를 표준 키로 유지

## 8. 현재 프로젝트 반영 상태 (2026-02-27 기준)

- 최종 요구사항 정의서 원본: `docs/요구사항_정의서.xlsx`
- 요구사항 총계: 90건 (기능 62건, 비기능 28건)
- ID 체계 메모: 기능은 `REQ-001~REQ-062`, 비기능은 `REQ-101~REQ-128` 체계를 사용한다.
- 개발완료 (1건): REQ-024
- 진행중 (1건): REQ-025
- 대기중 (88건): REQ-001~REQ-023, REQ-026~REQ-062, REQ-101~REQ-128

## 9. 범위 제외(Out of Scope)

- 병원 EMR 실시간 연동
- 의료 진단 확정/처방 대체 기능
- 알약 이미지 분류 기반 복약 분석
- 멀티언어 지원
- 고도화된 개인화 추천 엔진
- 영상 기반 실시간 객체 추적/복약 감시
- 보호자 전용 계정/입력/알림 기능

## 10. 검수 체크리스트

- 기능 요구사항 `높음` 우선순위 항목(REQ-001~REQ-004, REQ-006, REQ-009~REQ-015, REQ-021~REQ-032, REQ-034~REQ-038, REQ-040, REQ-042~REQ-043, REQ-045~REQ-058, REQ-061~REQ-062)이 구현되었는가
- 비기능 요구사항 `높음` 우선순위 항목(REQ-101, REQ-103~REQ-110, REQ-113~REQ-126)이 측정 가능하게 검증되었는가
- `중간/낮음` 우선순위 항목(REQ-005, REQ-007~REQ-008, REQ-016~REQ-020, REQ-033, REQ-039, REQ-041, REQ-044, REQ-059~REQ-060, REQ-102, REQ-111~REQ-112, REQ-127~REQ-128)은 반영 여부와 사유가 기록되었는가
- 요구사항 표의 상태 컬럼(`개발완료/진행중/대기중`)이 원본 xlsx와 일치하는가
- 최종 결과가 본 문서 기준과 일치하는가

## 11. 분리 문서 안내

- 객체 모델 명세와 API 계약 명세는 `docs/API_SPECIFICATION.md`로 분리했다.
- 팀 개발 실행 기준은 `docs/TEAM_DEVELOPMENT_GUIDELINE.md`를 따른다.

## 12. 요구사항 ID Naming (원본 시트)

원본 시트: `요구사항 ID Naming`

| Summary | 구분 | 설명 | 등록자 |
|---|---|---|---|
| REQ | 기본 | 기능/비기능 공통 요구사항 접두사입니다. 본 문서는 REQ-001 형태를 사용합니다. |  |
| NFR | 기본 | 본 문서는 비기능 요구사항도 REQ 접두사를 사용합니다. |  |
| USER | 기능구분 | 유저 관련 요구사항을 나타냅니다. |  |
