# AI Health Project 요구사항 정의서

문서 버전: v1.8  
작성일: 2026-02-23  
프로젝트 기간: 2026-02-20 ~ 2026-03-20  
배포 마감: 2026-03-13 (종료 1주 전)  
문서 목적: 프로젝트 범위, 구현 대상, 검수 기준을 명확히 합의한다.

문서 변경 이력:
- v1.8 (2026-02-23): OCR 원본 이미지 즉시 폐기(REQ-127) 구현 반영에 따른 현재 상태 섹션 업데이트
- v1.7 (2026-02-23): 요구사항 검수 반영(REQ-023/101/106 상태 분류 보완, 기능/비기능 ID 정렬 일관화)
- v1.6 (2026-02-23): OCR 원본 이미지 즉시 폐기 정책, 챗봇/이미지분석 고도화(하이브리드 검색, 출처 표기, 저유사도 재질문, 세션 자동 종료, 배경 노이즈 제거, 다중 객체 경고, 오분류 신고) 반영
- v1.5 (2026-02-23): 객체 모델/ API 계약 명세(기존 11~12장)를 `docs/API_SPECIFICATION.md`로 분리
- v1.0 (2026-02-20): OCR/가이드/기본 챗봇/알림 중심 초기 정의
- v1.1 (2026-02-23): 실시간 챗봇(RAG+SSE)과 알약 이미지 분류(CNN) 요구사항 상세화
- v1.2 (2026-02-23): OCR 기반 의료정보 인식(업로드->OCR->파싱->검증->저장/출력) 상세화
- v1.3 (2026-02-23): `docs/ADHD_CARE_SERVICE_BLUEPRINT.md` 반영(사용자 프로필 구조화, OCR 신뢰도 검증/수정, 개인화 분석 스키마, D-day 약 소진 알림)
- v1.4 (2026-02-23): 객체 모델(필수/선택)과 API Request/Response 계약 명세 추가

## 1. 범위

- 필수 기능:
  - OCR 기반 의료정보 인식
  - LLM 기반 복약/생활습관 맞춤 가이드 생성
  - 실시간 챗봇 (RAG + Streaming + Safety Guardrail)
  - 알약 이미지 분류 기반 복약 분석
  - 사용자 건강 입력(생활/수면/영양/병력) 구조화 및 위험도 분석
- 선택 기능:
  - 알림 기능(가이드 완료 알림, 복약 리마인더, 약 소진 D-day 알림)

## 2. 행위 주체(Actor)

- 일반 사용자: 회원가입, 건강 프로필 입력, 문서 업로드, OCR 결과 확인/수정, 가이드 조회, 챗봇 사용, 알약 분석 요청
- 보호자(선택): 소아 ADHD 사용자 복약/생활 정보 보조 입력 및 알림 확인
- AI 워커: OCR 처리, 파싱/정제, 가이드 생성, 챗봇 추론 파이프라인, 이미지 분류 추론 처리
- 시스템(API 서버): 인증, 검증, DB 저장, 큐 발행, 스트리밍 응답, 예외 처리
- 운영자(팀): 배포, 모니터링, 장애 대응, 지식베이스/모델/약물사전 버전 관리

## 3. 타겟 사용자 및 서비스 목표

- 주 타겟:
  - ADHD 약물을 복용 중인 성인/소아 환자 및 보호자
- 사용자 시나리오:
  - 사용자 가입 -> 개인 건강/생활 정보 입력 -> 처방전/약봉투 업로드 -> OCR/정제/확인 -> 맞춤형 복약/생활 가이드 제공 -> 약 소진 D-day 알림 수신
- 서비스 목표:
  - ADHD 환자의 일상 기록을 데이터 기반 건강 지표로 분석해 꾸준한 복약, 부작용 관리, 생활 패턴 교정을 지원한다.

## 4. 시스템 상세 로직 (System Logic)

### A. 실시간 챗봇 (RAG + Streaming Architecture)

1. 사용자 질문 수신 후 의도 분류(잡담/의학 질의/위급 질의)를 수행한다.
2. 자살/자해/범죄/약물 오남용 위기 신호가 감지되면 LLM 호출을 차단하고 긴급 상담 안내를 즉시 반환한다.
3. 의학 질의는 의미 기반(Dense)과 키워드 기반(Lexical)을 결합한 하이브리드 검색으로 ADHD 전문 의학 지식/약물 정보 Top 3~5 문서를 회수한다.
4. 검색 유사도가 임계값 미만이면 무리한 답변 대신 "질문을 조금 더 구체적으로 해주세요" 형태로 재질문을 유도한다.
5. 질문(Query), 검색 문서(Context), 최근 대화 이력(History), 시스템 제약을 결합해 답변을 생성한다.
6. 근거 문서가 존재하는 경우 답변 하단에는 사용된 문서의 출처/제목/링크를 함께 제공한다.
7. 답변은 SSE(Server-Sent Events)로 스트리밍 전송한다.
8. 세션 입력이 10~30분 이상 없으면 자동 종료해 리소스를 회수한다.

### B. 알약 이미지 분류 (CNN-based Classification)

1. 업로드 이미지는 224x224 기준 리사이즈/정규화하고 배경 노이즈 제거, 알약 영역 자동 탐지 또는 중앙 크롭을 적용한다.
2. 입력 이미지에서 다중 알약 객체가 감지되면 단일 객체 원칙에 따라 "한 번에 하나씩 촬영해 주세요" 경고를 반환한다.
3. CNN(ResNet/EfficientNet 계열)으로 ADHD 약물 클래스 확률을 계산한다.
4. 최고 확률 60% 미만 또는 OOD/품질 불량이면 판독 불가 처리한다.
5. 분류 성공 시 약물 ID 기반으로 약품 정보와 복약 가이드를 JSON으로 매핑해 반환한다.
6. 사용자가 결과를 오분류로 판단하면 올바른 약물명을 검색/선택해 수정 요청(오분류 신고)할 수 있다.

### C. OCR 기반 의료정보 인식 (Capture -> OCR -> Parse -> Store)

1. 사용자는 카메라 촬영 또는 갤러리 선택으로 처방전/약봉투(PDF/JPG/PNG)를 업로드한다.
2. 서버는 OCR 엔진(예: Clova OCR, Google Cloud Vision)으로 텍스트와 좌표를 추출한다.
3. 서버는 OCR 텍스트에서 `약품명/용량/1일 복용횟수/1회 복용개수/조제일/총 처방일`을 파싱한다.
4. 파싱 결과를 ADHD 약물 사전과 매핑 검증하고 신뢰도를 평가한다.
5. 임계값 미만이면 사용자 수정 요청(재촬영 또는 직접 수정) 단계로 전환한다.
6. 원본 업로드 이미지는 OCR/파싱 처리 완료 직후 즉시 폐기하며 DB/클라우드 스토리지에 파일 형태로 저장하지 않는다.
7. 확정 데이터는 DB 저장 후 복약 요약 문구와 알림 제안을 출력한다.

### D. 개인화 분석 및 가이드 생성

1. 사용자 입력(신체정보/병력/생활습관/수면/영양)과 OCR 정제 데이터를 하나의 컨텍스트 객체로 병합한다.
2. RAG 지식(약물 상호작용, 식단/운동 가이드)과 결합해 개인별 복약/생활습관 가이드를 생성한다.
3. 출력은 `복약 안내`, `생활습관 코칭`, `주의사항/위험징후` 구조로 제공한다.
4. 약 소진일을 계산하여 소진 7일 전부터 D-day 알림을 발행한다.

## 5. 기능적 요구사항

| ID | 구분 | 카테고리 | 요구사항 명칭 | 상세 내용 | 우선순위 | 비고 |
|---|---|---|---|---|---|---|
| REQ-001 | 기능 | 인증 | 회원가입 | 일반 사용자는 이메일, 비밀번호, 이름, 성별, 생년월일, 전화번호로 회원가입할 수 있어야 한다. | High | 이메일/전화번호 중복 불가 |
| REQ-002 | 기능 | 인증 | 로그인 | 일반 사용자는 이메일+비밀번호로 로그인할 수 있어야 하며, 성공 시 액세스 토큰을 받아야 한다. | High | refresh token은 HttpOnly 쿠키로 발급 |
| REQ-003 | 기능 | 인증 | 토큰 재발급 | 일반 사용자는 refresh token으로 액세스 토큰을 재발급 받을 수 있어야 한다. | High | refresh token 누락 시 401 |
| REQ-004 | 기능 | 인증 | 보호 API 접근 제어 | 시스템은 인증이 필요한 API 호출 시 JWT 검증 후 사용자 식별에 성공한 요청만 처리해야 한다. | High | 실패 시 401 |
| REQ-005 | 기능 | OCR | 의료문서 업로드 | 일반 사용자는 스마트폰 카메라/갤러리를 통해 처방전/약봉투 파일(PDF/JPG/PNG)을 업로드할 수 있어야 한다. | High | 모바일 우선 시나리오 |
| REQ-006 | 기능 | OCR | 업로드 유효성 검증 | 시스템은 허용 확장자 외 파일, 파일 크기 초과 파일, 손상 파일을 거절해야 한다. | High | 거절 시 400/413 |
| REQ-007 | 기능 | OCR | OCR 작업 생성 | 일반 사용자는 업로드 문서 OCR 작업을 생성할 수 있어야 하며, 시스템은 즉시 job_id와 QUEUED 상태를 반환해야 한다. | High | 비동기 처리 |
| REQ-008 | 기능 | OCR | OCR 상태 조회 | 일반 사용자는 OCR 작업 상태(QUEUED/PROCESSING/SUCCEEDED/FAILED)를 조회할 수 있어야 한다. | High | 본인 작업만 조회 가능 |
| REQ-009 | 기능 | OCR | OCR 결과 저장 | AI 워커는 OCR 성공 시 raw 텍스트, 좌표, 구조화 데이터를 DB에 저장해야 한다. | High | 실패 시 error_message 저장 |
| REQ-010 | 기능 | 가이드 | 가이드 작업 생성 | 일반 사용자는 OCR 완료 건 기반 가이드 생성 작업을 요청할 수 있어야 한다. | High | job_id, QUEUED 반환 |
| REQ-011 | 기능 | 가이드 | 가이드 상태 조회 | 일반 사용자는 가이드 작업 상태를 조회할 수 있어야 한다. | High | 본인 작업만 조회 가능 |
| REQ-012 | 기능 | 가이드 | 가이드 결과 조회 | 일반 사용자는 생성된 가이드(복약/생활습관/위험도)를 조회할 수 있어야 한다. | High | 결과 JSON 반환 |
| REQ-013 | 기능 | 가이드 | 안전 고지 포함 | 시스템은 가이드 결과에 "의료진 진료 대체 불가" 고지 문구를 항상 포함해야 한다. | High | 고정 문구 |
| REQ-014 | 기능 | 챗봇 | 채팅 세션 생성 | 일반 사용자는 챗봇 세션을 생성하고 ACTIVE 상태로 사용할 수 있어야 한다. | High | 세션 단위 이력 관리 |
| REQ-015 | 기능 | 챗봇 | 메시지 송수신/저장 | 일반 사용자는 질문을 전송하고 답변을 수신해야 하며, 시스템은 USER/ASSISTANT 메시지를 모두 저장해야 한다. | High | role, timestamp 저장 |
| REQ-016 | 기능 | 챗봇 | 대화 맥락 유지 | 시스템은 최근 5~10턴 이력을 반영하고 대명사 표현(예: "그 약")을 해석해 응답해야 한다. | High | 턴 수 설정 가능 |
| REQ-017 | 기능 | 챗봇 | 대화 이력 조회 | 일반 사용자는 세션별 대화 이력을 페이지네이션으로 조회할 수 있어야 한다. | Medium | limit/offset 지원 |
| REQ-018 | 기능 | 알림 | 알림 목록 조회 | 일반 사용자는 본인 알림 목록을 조회할 수 있어야 한다. | Medium | 선택 기능 |
| REQ-019 | 기능 | 알림 | 미읽음 개수 조회 | 일반 사용자는 미읽음 알림 개수를 조회할 수 있어야 한다. | Medium | 선택 기능 |
| REQ-020 | 기능 | 알림 | 알림 읽음 처리 | 일반 사용자는 단건 알림을 읽음 처리할 수 있어야 한다. | Medium | 선택 기능 |
| REQ-021 | 기능 | 알림 | 전체 읽음 처리 | 일반 사용자는 본인 알림을 전체 읽음 처리할 수 있어야 한다. | Medium | 선택 기능 |
| REQ-022 | 기능 | 알림 | 가이드 완료 알림 발행 | 시스템은 가이드 생성 성공 시 GUIDE_READY 유형 알림을 자동 생성해야 한다. | Medium | 선택 기능 |
| REQ-023 | 기능 | 알림 | 복약 리마인더 관리 | 일반 사용자는 복약 리마인더를 생성/조회/수정/삭제할 수 있어야 한다. | Low | 선택 기능 확장 |
| REQ-024 | 기능 | 예외처리 | OCR 실패 처리 | AI 워커 OCR 실패 시 상태를 FAILED로 변경하고 사용자 조회 응답에 실패 사유를 노출해야 한다. | High | 재시도 정책 별도 |
| REQ-025 | 기능 | 예외처리 | 가이드 생성 실패 처리 | LLM 호출 실패/시간초과 시 상태를 FAILED로 저장하고 실패 사유를 반환해야 한다. | High | 타임아웃 기준 적용 |
| REQ-026 | 기능 | 권한 | 리소스 접근 권한 | 시스템은 사용자 본인 데이터(문서/작업/가이드/채팅/알림/이미지분석결과)만 접근 허용해야 한다. | High | 타 사용자 접근 403/404 |
| REQ-027 | 기능 | 챗봇 | 입력 의도 분류 | 시스템은 사용자 입력을 잡담/의학/위급으로 분류해야 한다. | High | 분류 실패 시 안전 우선 |
| REQ-028 | 기능 | 챗봇 | 안전 가드레일 | 자살/자해/범죄/약물 오남용 신호 감지 시 LLM 호출을 차단하고 긴급 상담 메시지를 반환해야 한다. | High | 정책 문구 사전 정의 |
| REQ-029 | 기능 | 챗봇 | 벡터 검색 기반 지식 회수 | 의학 질의는 ADHD 전문 의학 지식 Vector DB에서 유사 문서 3~5개를 검색해 사용해야 한다. | High | 검색 근거 로깅 |
| REQ-030 | 기능 | 챗봇 | 근거 제한 답변 | 챗봇은 승인된 의료 근거 기반 정보만으로 답변하고 근거 없으면 모른다고 응답해야 한다. | High | Hallucination 억제 |
| REQ-031 | 기능 | 챗봇 | SSE 스트리밍 응답 | 챗봇 답변은 SSE로 스트리밍 전송되어야 한다. | High | 첫 토큰 3초 이내 목표 |
| REQ-032 | 기능 | 챗봇 | 추론 감사 로그 | 시스템은 답변 생성 시 검색 문서 ID, 프롬프트 버전, 모델 버전을 추적 저장해야 한다. | Medium | 운영/품질 분석 용도 |
| REQ-033 | 기능 | 이미지분석 | 알약 이미지 업로드 | 일반 사용자는 단일 알약 이미지 1장을 업로드해 분석 요청할 수 있어야 한다. | High | 파일 형식/크기 제한 |
| REQ-034 | 기능 | 이미지분석 | 이미지 전처리 | 시스템은 분류 전 이미지를 224x224 리사이즈 및 정규화 처리해야 한다. | High | 전처리 버전 관리 |
| REQ-035 | 기능 | 이미지분석 | CNN 분류 추론 | 시스템은 주요 ADHD 치료제 10종 클래스 확률값(Confidence)을 계산해야 한다. | High | ResNet/EfficientNet 계열 |
| REQ-036 | 기능 | 이미지분석 | 판독 불가 처리 | 최고 확률 60% 미만, 흐림/잘림, OOD 입력이면 판독 불가와 재촬영 가이드를 반환해야 한다. | High | 오진 방지 우선 |
| REQ-037 | 기능 | 이미지분석 | 약물 정보 매핑 | 분류 성공 시 약품명/성분/효능/부작용과 복약 가이드(JSON)를 반환해야 한다. | High | 약물 ID 키 기반 |
| REQ-038 | 기능 | 이미지분석 | 결과 저장 및 조회 | 시스템은 이미지 분석 결과(예측 클래스, confidence, 판독 상태)를 저장/조회 가능해야 한다. | Medium | 재검토/통계 활용 |
| REQ-039 | 기능 | OCR | OCR 엔진 연동 | 서버는 업로드 문서를 외부 OCR 엔진에 전달하고 텍스트+좌표를 수신해야 한다. | High | 엔진 교체 가능 구조 |
| REQ-040 | 기능 | OCR | 데이터 파싱/정제 | OCR 텍스트에서 `약품명`, `용량`, `1일 복용 횟수`, `총 복용일`을 구조화 추출해야 한다. | High | 정규식/LLM 보조 가능 |
| REQ-041 | 기능 | OCR | ADHD 약물 매핑 검증 | 파싱된 약품명이 ADHD 약물 리스트 DB와 일치하는지 검증하고 결과를 저장해야 한다. | High | 미매핑 항목 검수 상태 |
| REQ-042 | 기능 | OCR | 재촬영 유도 처리 | 흔들림/반사/텍스트 부족 등 인식 불량 시 재촬영 안내 메시지를 반환해야 한다. | High | 재촬영 가이드 포함 |
| REQ-043 | 기능 | OCR | 촬영 가이드 UX 지원 | 프론트는 가이드 박스 오버레이, 좋은/나쁜 예 안내, 촬영 전 팝업을 제공해야 한다. | Medium | 모바일 카메라 UX |
| REQ-044 | 기능 | OCR | 구조화 결과 스키마 저장 | OCR 결과를 환자/날짜/약품/용량/복용횟수/복용일수 중심 JSON 스키마로 저장해야 한다. | High | 처방 이력 활용 |
| REQ-045 | 기능 | OCR | 사용자 결과 출력 | 화면에 복약 시작 요약 문구와 알림 설정 제안을 출력해야 한다. | Medium | 리마인더 연계 |
| REQ-046 | 기능 | 프로필 | 건강 프로필 입력 | 사용자는 키/몸무게/병력/수면/생활습관/영양 상태를 입력할 수 있어야 한다. | High | 설문 UI |
| REQ-047 | 기능 | 프로필 | 입력 데이터 구조화 | 시스템은 사용자 입력을 사전 정의한 입력 스키마 객체로 구조화해 저장해야 한다. | High | JSON 스키마 검증 |
| REQ-048 | 기능 | OCR | 신뢰도 임계값 검증 | OCR/파싱 결과에 대해 필드별 신뢰도 임계값을 적용하고 미달 시 수정 플로우로 전환해야 한다. | High | 중요도: 약물명 > 용량 > 횟수 > 일자 |
| REQ-049 | 기능 | OCR | 사용자 확인/수정 단계 | OCR 정제 결과를 사용자에게 보여주고 확인 또는 직접 수정 후 확정할 수 있어야 한다. | High | Human-in-the-loop |
| REQ-050 | 기능 | 가이드 | 개인 컨텍스트 결합 | `[프로필 입력] + [OCR 처방 정보] + [RAG 지식]`을 병합해 가이드 생성 컨텍스트를 구성해야 한다. | High | 개인화 핵심 |
| REQ-051 | 기능 | 알림 | 약 소진 D-day 알림 | 조제일/총 처방일/복용량 기반 약 소진일 계산 후 소진 7일 전부터 D-day 알림을 제공해야 한다. | High | 7일 전 시작 |
| REQ-052 | 기능 | 분석 | 생활패턴 지표 분석 | 운동/디지털 사용/카페인/흡연/음주/수면/영양 입력을 건강 지표로 분석해야 한다. | High | 위험도 계산 |
| REQ-053 | 기능 | 분석 | 위험 징후 플래그 | 알코올 위험, 과도한 졸림, 영양위험 등 위험 플래그를 자동 산출해야 한다. | High | 경고문구 포함 |
| REQ-054 | 기능 | 분석 | 약물 알러지 경고 | 사용자 약물 알러지 정보와 처방 약물을 대조해 충돌 시 경고를 제공해야 한다. | High | 즉시 진료 안내 |
| REQ-055 | 기능 | 가이드 | 출력 포맷 표준화 | 최종 가이드는 `복약안내/생활습관/주의사항` 3개 섹션 구조를 유지해야 한다. | High | UI 일관성 |
| REQ-056 | 기능 | LLM | 구조화 출력 강제 | LLM 응답은 정의된 JSON 스키마를 따르도록 강제하고 파싱 가능해야 한다. | High | JSON 모드/스키마 강제 |
| REQ-057 | 기능 | LLM | 역할/제약 프롬프트 | 시스템 프롬프트에 역할/안전제약/의료진 상담 고지 규칙을 포함해야 한다. | Medium | 정책 버전 관리 |
| REQ-058 | 기능 | 챗봇 | 하이브리드 검색 | 시스템은 의학 질의 검색 시 Dense 벡터 검색과 키워드 검색(BM25 등)을 결합해 근거 문서를 회수해야 한다. | High | 의미+단어 일치 보정 |
| REQ-059 | 기능 | 챗봇 | 출처 표기 응답 | 챗봇 답변은 근거 문서가 존재하는 경우 해당 문서의 제목/출처/링크를 하단에 표시해야 한다. | Medium | 신뢰도 향상 |
| REQ-060 | 기능 | 챗봇 | 저유사도 재질문 유도 | 검색 유사도가 임계값 미만이면 확정 답변 대신 사용자에게 질문 구체화를 요청해야 한다. | High | 무리한 생성 방지 |
| REQ-061 | 기능 | 챗봇 | 자동 세션 종료 | 입력/출력이 없는 비활성 세션은 10~30분 설정값 경과 시 CLOSED 상태로 자동 종료해야 한다. | Medium | 리소스 회수 |
| REQ-062 | 기능 | 이미지분석 | 배경 노이즈 제거 전처리 | 시스템은 추론 전 배경 노이즈 제거와 ROI 탐지(또는 중앙 크롭)를 적용해 알약 영역 중심으로 입력을 정제해야 한다. | High | 전처리 고도화 |
| REQ-063 | 기능 | 이미지분석 | 다중 객체 경고 | 이미지에 복수 알약이 감지되면 분석을 중단하고 "한 번에 하나씩 촬영" 안내를 반환해야 한다. | High | 단일 객체 원칙 |
| REQ-064 | 기능 | 이미지분석 | 오분류 신고/수정요청 | 사용자는 분석 결과가 틀렸다고 판단 시 올바른 약물명을 검색/선택해 오분류 신고를 제출할 수 있어야 한다. | Medium | 데이터 라벨링 피드백 |

## 6. 비기능적 요구사항

| ID | 구분 | 카테고리 | 요구사항 명칭 | 상세 내용 | 우선순위 | 비고 |
|---|---|---|---|---|---|---|
| REQ-101 | 비기능 | 성능 | 핵심 응답 지연 | 챗봇 첫 토큰(TTFT)과 이미지 분석 API 응답 시간은 P95 3초 이내를 목표로 한다. | High | 평가 기준 반영 |
| REQ-102 | 비기능 | 성능 | 비동기 요청 즉시 응답 | OCR/가이드 작업 생성 API는 1초 이내 `202 Accepted`를 반환해야 한다. | High | 무거운 처리 금지 |
| REQ-103 | 비기능 | 안정성 | 비동기 상태 일관성 | Job 상태 전이는 `QUEUED -> PROCESSING -> SUCCEEDED/FAILED`만 허용한다. | High | 불가능 전이 차단 |
| REQ-104 | 비기능 | 보안 | 인증/암호화 | 비밀번호는 단방향 해시로 저장하고 인증은 JWT 기반으로 처리해야 한다. | High | 평문 저장 금지 |
| REQ-105 | 비기능 | 보안 | 쿠키 보안 옵션 | 운영환경 refresh token 쿠키는 HttpOnly+Secure 옵션을 사용해야 한다. | High | SameSite 정책 명시 |
| REQ-106 | 비기능 | 품질 | 프롬프트/모델 버전 고정 | 챗봇/가이드 품질 편차를 줄이기 위해 prompt/model/파라미터 버전을 관리해야 한다. | High | 재현성 확보 |
| REQ-107 | 비기능 | 모니터링 | 추적 가능한 로그 | API/워커 로그에 request_id/job_id/user_id를 남겨 장애 추적이 가능해야 한다. | High | 개인정보 마스킹 |
| REQ-108 | 비기능 | 테스트 | 자동 검증 | CI에서 테스트/린트/타입체크가 모두 통과해야 배포 가능하다. | High | pytest/ruff/mypy |
| REQ-109 | 비기능 | 배포 | 배포 완료 시점 | 프로젝트 종료 1주 전(2026-03-13)까지 스테이징/운영 배포가 완료되어야 한다. | High | 평가 일정 준수 |
| REQ-110 | 비기능 | 확장성 | 구조 확장성 | OCR/가이드/챗봇/이미지분류 모델 교체 시 API 계약 변경 없이 워커 레이어에서 교체 가능해야 한다. | Medium | 추후 고도화 대비 |
| REQ-111 | 비기능 | 데이터 | 저장 포맷 표준화 | 문서, OCR 결과, 가이드, 채팅, 이미지분석 데이터는 UTF-8과 JSON 스키마를 일관 사용해야 한다. | Medium | 한글 깨짐 방지 |
| REQ-112 | 비기능 | 가용성 | 장애 복구 | 장애 발생 시 30분 이내 롤백 또는 임시복구 절차를 수행할 수 있어야 한다. | Medium | 운영 체크리스트 필요 |
| REQ-113 | 비기능 | 프라이버시 | 학습 데이터 재사용 금지 | 사용자 채팅 로그와 업로드 이미지는 모델 학습 데이터로 재사용하지 않아야 한다. | High | 동의 기반 정책 별도 |
| REQ-114 | 비기능 | 보안 | 전송 구간 암호화 | 운영환경 사용자 트래픽은 HTTPS(TLS)로 암호화되어야 한다. | High | 인증서 갱신 자동화 |
| REQ-115 | 비기능 | 확장성 | 벡터 DB 무중단 갱신 | 의학 지식 문서 추가/수정 시 서비스 중단 없이 인덱스를 갱신할 수 있어야 한다. | Medium | Blue/Green 권장 |
| REQ-116 | 비기능 | 확장성 | 모델 가중치 교체 용이성 | 이미지 분류 모델 가중치 파일 교체만으로 신규 버전을 반영할 수 있어야 한다. | Medium | 롤백 버전 보관 |
| REQ-117 | 비기능 | 성능 | 비동기 논블로킹 처리 | 챗봇 스트리밍/이미지 분석 API는 이벤트 루프 블로킹을 최소화해야 한다. | High | 워커 오프로딩 병행 |
| REQ-118 | 비기능 | 안전성 | 가드레일 정책 감사성 | 위급 질의 차단 이벤트는 감사 가능한 형태로 기록/모니터링되어야 한다. | High | 정책 위반 탐지 |
| REQ-119 | 비기능 | 사용성 | 모바일 촬영 최적화 | OCR 입력 UI는 모바일 반응형과 카메라 촬영 UX를 우선 설계해야 한다. | High | 스마트폰 주 시나리오 |
| REQ-120 | 비기능 | 성능 | OCR 처리 지연 기준 | 이미지 업로드 후 OCR 추출/파싱/결과 출력까지 권장 5초 이내를 목표로 한다. | High | 로딩 스피너 필수 |
| REQ-121 | 비기능 | 데이터 | 합성 데이터 우선 활용 | 모델 학습/테스트는 실제 환자 데이터 대신 합성 데이터 우선 정책을 따른다. | High | 개인정보 이슈 완화 |
| REQ-122 | 비기능 | 품질 | 필드별 신뢰도 정책 | OCR 필드별 최소 신뢰도와 재질문/수정 정책을 운영 설정으로 관리해야 한다. | High | 필드 중요도 반영 |
| REQ-123 | 비기능 | 데이터 | 스키마 유효성 강제 | 입력/출력 JSON은 스키마 검증 실패 시 저장/전송을 차단해야 한다. | High | 데이터 무결성 |
| REQ-124 | 비기능 | 안정성 | 외부 API 장애 대응 | OCR/LLM 외부 API 타임아웃, 재시도, 오류코드 표준화를 제공해야 한다. | High | 운영 알림 연계 |
| REQ-125 | 비기능 | 설명가능성 | 근거 추적성 | 가이드/경고 생성 시 사용된 입력 필드와 근거 출처를 추적 가능해야 한다. | Medium | 감사/검증 용도 |
| REQ-126 | 비기능 | 정확성 | 약 소진 계산 정확성 | 소진일 계산 로직은 조제일/복용주기/복용개수 반영 오차 없이 동작해야 한다. | High | D-day 신뢰도 |
| REQ-127 | 비기능 | 프라이버시 | OCR 원본 이미지 즉시 폐기 | OCR/파싱 완료 후 원본 업로드 이미지는 즉시 삭제하고 DB/클라우드 스토리지에 파일 형태로 보관하지 않아야 한다. | High | 데이터 최소화/비용 절감 |

## 7. 데이터 구축 및 스키마

### 7.1 챗봇 지식 베이스 (Knowledge Base)

- 데이터 소스:
  - 국가건강정보포털
  - 대한소아청소년정신의학회 자료
  - 의약품안전나라 약물 설명서(PDF/텍스트)
- 구축 절차:
  - 원문 수집 -> 정제/중복 제거 -> 청크 분할 -> 임베딩 -> Vector DB 적재
  - 출처/버전/갱신일 메타데이터 저장

### 7.2 이미지 데이터셋 및 학습

- 대상 클래스:
  - 국내 주요 ADHD 치료제 10종(예: 콘서타 OROS 18/27/36/54mg, 메디키넷, 아토목세틴)
- 데이터 수집:
  - 약학정보원 기반 크롤링 + 실물 촬영 데이터 보강
- 데이터 목표:
  - 클래스당 최소 100장 이상 확보
  - 불균형 완화를 위한 증강(Augmentation) 적용

### 7.3 OCR 데이터 요구사항

- ADHD 약물 사전(DB):
  - 처방전/약봉투에서 추출할 타겟 키워드 리스트
- OCR 원문 저장:
  - 텍스트 블록 + 좌표(Bounding Box) + 엔진 메타데이터
- OCR 원본 이미지 보관 정책:
  - OCR/파싱 완료 직후 원본 파일 즉시 폐기(비영속 처리)
  - DB/클라우드 스토리지에 원본 이미지 파일 미저장
- OCR 결과 스키마(핵심):
  - `raw_text`
  - `extracted_medications[].drug_name`
  - `extracted_medications[].dose`
  - `extracted_medications[].frequency_per_day`
  - `extracted_medications[].dosage_per_once`
  - `extracted_medications[].dispensed_date`
  - `extracted_medications[].total_days`

### 7.4 사용자 입력 스키마(핵심)

- `basic_info`: `height_cm`, `weight_kg`
- `medical_history`: `underlying_diseases`, `psychiatric_diseases`, `surgical_history`, `drug_allergies`
- `lifestyle_input`:
  - `exercise_hours(low/moderate/high)`
  - `digital_usage(pc_hours_per_day, smartphone_hours_per_day)`
  - `substance_usage(caffeine_cups_per_day, smoking, alcohol_frequency_per_week)`
- `sleep_input`: `bed_time`, `wake_time`, `sleep_latency_minutes`, `night_awakenings_per_week`, `daytime_sleepiness_score`
- `nutrition_input`: `appetite_score`, `is_meal_regular`
- `ocr_result`: OCR 정제 처방 데이터

### 7.5 출력 스키마(핵심)

- `analysis_summary`:
  - `basic_info(age, sex, bmi, weight_status)`
  - `lifestyle_analysis(weighted_exercise_score, total_digital_time, substance_risk)`
  - `sleep_analysis(calculated_sleep_hours, sleep_quality_status)`
  - `nutrition_analysis(nutrition_status, malnutrition_risk)`
- `personalized_guides`:
  - `medication_guide(schedule, substance_caution, refill_reminder_days_before)`
  - `health_coaching(nutrition_guide, exercise_guide, concentration_strategy, sleep_guide)`
- `risk_flags`:
  - `is_alcohol_addiction_risk`
  - `is_drug_allergy_alert`
  - `is_psychiatric_followup_needed`

## 8. 현재 프로젝트 반영 상태 (2026-02-23 기준)

- 구현 완료 또는 베이스라인 존재:
  - REQ-001~013, REQ-018~022, REQ-024~026
  - REQ-102~105, REQ-107~112, REQ-127
- 미구현 또는 고도화 필요:
  - 알림 확장(복약 리마인더): REQ-023
  - 챗봇 본 기능 전반: REQ-014~017, REQ-027~032, REQ-056~061
  - 이미지 분류 전반: REQ-033~038, REQ-062~064
  - OCR 고도화(외부 OCR/파싱/신뢰도/수정 루프): REQ-039~045, REQ-048~049
  - 사용자 프로필/개인화 분석/위험 플래그: REQ-046~047, REQ-050~055
  - 약 소진 D-day 알림: REQ-051, REQ-126
  - 성능/품질 운영 기준 보강: REQ-101, REQ-106
  - 프라이버시/확장성/안전성 보강: REQ-113~125

## 9. 범위 제외(Out of Scope)

- 병원 EMR 실시간 연동
- 의료 진단 확정/처방 대체 기능
- 멀티언어 지원
- 고도화된 개인화 추천 엔진
- 영상 기반 실시간 객체 추적/복약 감시

## 10. 검수 체크리스트

- 기능 요구사항 High 항목(REQ-001~013, REQ-014~016, REQ-024~031, REQ-033~037, REQ-039~042, REQ-044, REQ-046~056, REQ-058, REQ-060, REQ-062~063)이 구현되었는가
- 비기능 요구사항 High 항목(REQ-101~109, REQ-113~114, REQ-117~124, REQ-126~127)이 측정 가능하게 검증되었는가
- 선택 기능(REQ-017~023, REQ-032, REQ-038, REQ-043, REQ-045, REQ-057, REQ-059, REQ-061, REQ-064, REQ-110~112, REQ-115~116, REQ-125)은 반영 여부와 사유가 기록되었는가
- 최종 결과가 본 문서 기준과 일치하는가

## 11. 분리 문서 안내

- 객체 모델 명세(기존 11장)와 API 계약 명세(기존 12장)는 `docs/API_SPECIFICATION.md`로 분리했다.
- 기존 11~12장 내용은 손실 없이 `docs/API_SPECIFICATION.md`에 원문 그대로 이전했다.

